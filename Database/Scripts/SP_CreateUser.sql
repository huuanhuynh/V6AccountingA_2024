IF NOT EXISTS(SELECT * FROM   INFORMATION_SCHEMA.COLUMNS WHERE  TABLE_NAME = 'V6User'AND COLUMN_NAME = 'Salt') 
	ALTER TABLE V6User
	ADD Salt nvarchar(36) NOT NULL
GO
IF NOT EXISTS(SELECT * FROM   INFORMATION_SCHEMA.COLUMNS WHERE  TABLE_NAME = 'V6User'AND COLUMN_NAME = 'PasswordHash') 
	ALTER TABLE V6User
	ADD PasswordHash BINARY(64) NOT NULL
GO

IF EXISTS(select 1 from sysobjects  where name = 'SP_CREATEUSER')
	drop proc SP_CREATEUSER
GO

CREATE PROCEDURE SP_CREATEUSER
	@ModuleId			char(1),
	@Username			varchar(50),
	@Password			varchar(50),
	@UserPre			varchar(8),
	@Comment			varchar(48),
	@IsAdmin			bit,
	@IsVAdmin			bit,
	@Rights				text,
	@DelY_N				numeric(18,0),
	@DeletionRights		text,
	@ModificationRights	text,
	@AdditionRights		text,
	@UserId2			numeric(9,0),
	@UserAcc			tinyint,
	@UserInv			tinyint,
	@Pagedefa			tinyint,
	@WarehouseRights	text,
	@DvcsRights			text,
	@UserOther			varchar(1),
	@InheritId			numeric(3,0),
	@InheritCh			varchar(1),
	@CheckSync			varchar(100),
	@Level				varchar(2)
AS
BEGIN
	DECLARE @Salt UNIQUEIDENTIFIER = NEWID()
	DECLARE @PasswordHash BINARY(64)
	SET @PasswordHash = HASHBYTES('SHA2_512', @Password+CAST(@Salt AS NVARCHAR(36)))

INSERT INTO [dbo].[V6user]
           (Module_id,[user_name],[Salt], [PasswordHash],[user_pre],[comment],[is_admin],[is_Vadmin],[rights],[del_yn],[r_del],[r_edit],[r_add]
		   ,[user_id2],[user_acc],[user_inv],[Pagedefa],[r_kho],[r_dvcs],[USER_OTHER],[Inherit_id],[inherit_ch],[CHECK_SYNC],[LEVEL])
     VALUES
           (@ModuleId, @Username, @Salt, @PasswordHash, @UserPre,@Comment,@IsAdmin,@IsVAdmin,@Rights,@DelY_N,@DeletionRights, @ModificationRights, @AdditionRights,
		   @UserId2, @UserAcc, @UserInv, @Pagedefa, @WarehouseRights, @DvcsRights, @UserOther, @InheritId, @InheritCh, @CheckSync, @Level)
END

/*=================HOW TO EXECUTE=====================

Exec SP_CREATEUSER 'A', 'tmtri', '123456', '','Administrator',1,0
,'C0101003/C0101007/C0101008/C0101009/C0101030/C0103004/C0103005/C0103006/C0104010/C0104011/C0104012/C0104013/C0104014/C0108015/C0108016/C0108017/C0108018/C0108019/C0108022/C0108027/C0108028/C0108040/C0201002/C0201003/C0201004/C0201005/C0202011/C0202012/C0202013/C0202014/C0202015/C0202016/C0202017/C0202018/C0202019/C0202020/C0202021/C0202022/C0202023/C0202024/C0203025/C0203026/C0301004/C0301005/C0301006/C0301007/C0301008/C0301009/C0301010/C0301011/C0301013/C0301014/C0302016/C0302017/C0302018/C0302019/C0302020/C0302021/C0302022/C0302023/C0302024/C0302025/C0302026/C0302027/C0302028/C0302029/C0302031/C0302032/C0302033/C0302034/C0302035/C0302036/C0302037/C0302038/C0302039/C0302040/C0302041/C0302042/C0302043/C0302044/C0302045/C0302046/C0302047/C0302056/C0302057/C0303012/C0303048/C0303049/C0303050/C0303051/C0304052/C0304053/C0304054/C0304055/C0401003/C0401004/C0401005/C0401006/C0401007/C0401008/C0401009/C0401010/C0401011/C0401012/C0401013/C0401014/C0401015/C0402016/C0402017/C0402018/C0402019/C0402020/C0402021/C0402022/C0402023/C0402024/C0402025/C0402027/C0402028/C0402029/C0402030/C0402031/C0402032/C0402033/C0402034/C0402035/C0402036/C0402037/C0402038/C0402039/C0402040/C0402041/C0402042/C0402043/C0402048/C0403044/C0403045/C0404046/C0404047/C0501002/C0501003/C0501004/C0501005/C0501006/C0501007/C0501008/C0501009/C0501011/C0502012/C0502013/C0502014/C0502015/C0502016/C0502017/C0502018/C0502019/C0502020/C0502021/C0502022/C0502023/C0502024/C0502025/C0502026/C0502027/C0502028/C0502029/C0502030/C0502031/C0502032/C0502033/C0502035/C0502036/C0502037/C0502038/C0502039/C0502040/C0502041/C0502042/C0502043/C0502044/C0502045/C0503046/C0503047/C0503048/C0503049/C0503050/C0504051/C0504052/C0504053/C0602003/C0602004/C0602005/C0602006/C0602007/C0602008/C0602009/C0602010/C0602011/C0602012/C0602013/C0602014/C0602015/C0602016/C0602017/C0602018/C0602020/C0602021/C0602022/C0602023/C0602024/C0602025/C0602026/C0602027/C0602028/C0602032/C0602033/C0602034/C0602035/C0602036/C0602037/C0602038/C0602039/C0602040/C0602041/C0602042/C0602045/C0602046/C0603043/C0603047/C0603048/C0604029/C0604030/C0701003/C0701004/C0701005/C0701006/C0701007/C0702011/C0702012/C0702013/C0702014/C0702015/C0702016/C0702017/C0702018/C0702019/C0703002/C0703020/C0703021/C0703022/C0703023/C0704024/C0704025/C0704026/C0704027/C0801001/C0801004/C0801005/C0801006/C0801007/C0801021/C0801022/C0801068/C0801071/C0801149/C0801150/C0802009/C0802010/C0802011/C0802012/C0802013/C0802014/C0802015/C0802016/C0802017/C0802020/C0802023/C0802024/C0802025/C0802026/C0802027/C0802028/C0802029/C0802033/C0802034/C0802035/C0802036/C0802037/C0802038/C0802039/C0802040/C0802041/C0802046/C0802047/C0802048/C0802049/C0802050/C0802051/C0802052/C0802065/C0802066/C0802067/C0802070/C0802072/C0802073/C0802074/C0802108/C0802109/C0802110/C0802111/C0802112/C0802113/C0802114/C0802115/C0802116/C0802117/C0802118/C0802119/C0802120/C0802121/C0802122/C0802123/C0802124/C0802125/C0802126/C0802127/C0802128/C0802129/C0802130/C0802131/C0802132/C0802133/C0802134/C0802135/C0803003/C0803005/C0803053/C0803054/C0803055/C0803056/C0803136/C0804057/C0804058/C0804059/C0804060/C0804061/C0804062/D0000001/D0000002/D0000004/D0000005/D0000006/D0000007/D0000008/D0000009/D0000010/D0000011/D0000012/D0000014/D0000015/D0000016/D0000018/D0000019/D0000020/D0000021/D0000022/D0000030/D0000031/D0000032/D0000033/D0000034/D0000035/D0000036/D0000037/D0000038/D0000039/D0000040/D0000041/D0000042/D0000043/D0000044/D0000045/D0000046/D0000047/D0000048/D0000049/D0000050/D0000051/D0000052/D0000053/D0000054/D0000055/D0000056/D0000057/D0000058/D0000059/D0000060/D0000061/D0000062/D0000063/D0000064/D0000065/D0000066/D0000067/D0000068/D0000069/D0000070/D0000071/D0000072/D0000073/D0000074/D0000075/D0000076/D0000077/D0000078/D0000079/D0000080/D0000081/D0000082/D0000083/D0802024/DAE00001/DAE00002/DAE00004/DAE00006/DAE00007/DAE00008/DAE00011/DAE00013/DAE00014/DAE00015/DAE00016/DAE00017/DAE00018/DAE00019/DAE00020/DAE00021/DAE00022/DAE00023/DAE00024/DAE00025/DAE00026/DAE00027/DAE00028/DAE00029/DAE00030/DAE00032/DAE00033/DAE00034/DAE00035/DAE00036/DAE00037/DAE00038/DAE00039/DAE00048/DAQ00001/DAQ00002/DAQ00003/DAQ00004/DAQ00005/DAQ00006/DAQ00007/DAQ00008/DE000001/DE000002/DE000003/DE000004/DE000005/DE000006/DE000007/DE000008/DE000009/DE000010/DE000011/DE000012/DE000013/DE000014/DE000015/DE000016/DE000017/DE000018/DE000019/DE000075/DE000079/DE000091/DE000092/DE000093/DE000094/DE000095/DE000096/DE000098/DE000099/DE000100/DE000101/DE000102/DE000103/DE000104/DE000105/DE000106/DE000107/DE000108/DE000109/DE000110/DE000111/DE000112/DE000113/DE000114/DE000123/DE000124/DE000125/DE000126/DE000127/DE000128/DE000129/DE000130/DE000131/DE000132/DE000133/DE000134/DE000135/DE000136/DE000137/DE000138/DE000139/DE000140/DE000141/DE000142/DE000143/DE000144/DE000145/DE000146/DE000147/DE000148/DE000149/DE000150/DE000151/DE000152/DE000153/DE000154/DE000155/DE000156/DE000157/DE000158/DE000159/DE000160/DE000161/DE000162/DE000163/DE000164/DE000165/DE000166/DE000167/DE000168/DE000169/DE000170/DE000171/DE000172/DE000173/DE000174/DE000175/DE000176/DE000177/DE000178/DE000179/DE000180/DE000181/DE000182/DE000183/DE000184/DE000185/DE000186/DE000187/DE000188/DE000189/DE000190/DE000191/DE000192/DE000193/DE000194/DE000195/DE000196/DE000197/DE000198/DE000199/DE000200/DE000201/DE000202/DE000203/DE000204/DE000205/DE000206/DE000207/DE000208/DE000231/DE000232/DE000233/DE000234/DE000235/DE000238/DE000239/DE000240/DE000241/DE000242/DE000243/DE000244/DE000245/DE000246/DE000247/DE000248/DE000249/DE000250/DE000251/DE000252/DE000253/DE000254/DE000255/DE000256/DE000257/DEN00254/DEN00255/DEN00256/DEN00257/DEN00258/DEN00259/DEN00260/DEN00261/DEN00262/DEN00263/DEN00264/DEN00267/DEN00268/DEN00269/DEN00270/DEN00271/DEN00272/DEN00273/DEN00274/DEN00275/DEN00276/DEN00277/DEN00278/DEN00279/DEN00280/DEN00281/DEN00282/DEN00283/DEN00284/DEN00285/DEN00286/DEN00287/DEN00288/DEN00289/DEN00290/DEN00291/DEN00292/DEN00293/DEN00294/DEN00295/DEN00296/DEN00297/DEN00298/DEN00299/DEN00300/DEN00302/DEN00303/DEN00304/DEN00305/DEN00306/DEN00307/DEN00308/DEN00309/DEN00310/DEN00311/DEN00312/DEN00313/DEN00314/DET28001/DET28002/DET28003/DEV00277/DEV00278/DEV00279/DEV00280/DEV00281/DEV00282/DEV00283/DEV00284/DEV00285/DEV00286/DEV00287/DEV00288/DEV00289/DEV00292/DEV00293/DPE00033/DPE00034/DPE00035/DPE00043/DPE00044/DPE00045/DPE00046/DPE00047/HM000009/HM000010/HM000012/HM000013/HM000014/HM000015/HM000017/HM000019/HM000020/HM000021/HM000026/HM000028/HM000029/HM000030/HM000031/HM000032/HM000033/HM000034/HM000035/HM000036/HM000037/HM000038/HM000039/HM000040/HM000041/HM000042/HM000043/HM000044/HM000046/HM000047/HM000048/HM000050/HM000051/HM000052/HM000054/HM000055/HM000056/HM000057/HM000058/HM000059/HM000061/HM000062/HM000063/HM000064/HM000065/HM000067/HM000068/HM000069/HM000070/HM000071/HM000072/HM000073/HM000074/HM000076/HM000077/HM000078/HM000079/HM000080/HM000081/HM000082/HM000083/HM000085/HM000086/HM000087/HM000088/HM000089/HM000090/HM000091/HM000092/HM000093/HM009999//B0000000'
,0,'','','',38,0,0,1,'','',1,38,'','',01

=====================================================*/


